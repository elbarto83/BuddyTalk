<!doctype html>
<html>
  <head>
    <title>BuddyTalk</title>

    <style type="text/css">
      
      .input-block {
        display: block;
      }

      .chat-block {
        display: none;
      }
      input {
        outline: 0;
        padding: 2px 5px;
      }
      input:focus {
        outline: 0;
        border: 1px solid #333;

      }
    </style>
  </head>
  <body>
    

    <div class="input-block">
      <input type="text" id="username" placeholder="User name please ">
    </div> 

    <div class="chat-block">
        <div id="self"></div>
        
        <p>--------------------------------------Loggedin users---------------------------------------</p>
        <div id="users"></div>

        <p>------------------------------------------Rooms--------------------------------------------</p>
        <ul id="rooms"></ul>
        Room create/join/leave:
          <input id="room" autocomplete="off"/>
          <button id="createRoomBtn">Create</button>
          <button id="joinRoomBtn">Join</button>
          <button id="leaveRoomBtn">Leave</button>
        
        <p>--------------------------------------Message Board----------------------------------------</p>
        <ul id="messages"></ul>

        <p>-------------------------------------Send your message-------------------------------------</p>
        <input type="text" id="recipient_user" placeholder="User name please ">
        <input type="text" id="recipient_room" placeholder="Room name please ">

        <form action="#">
          <input id="m" autocomplete="off"/>
          <button>Send</button>
        </form>
        
    </div>

    

    <script src="/socket.io/socket.io.js"></script>
    <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
    <script>
      /* jquery */
      var username = '';
      var socket;

      $("#username").keydown(function(event){
       if(event.which == 13) {
          $('.chat-block').show();
          $('.input-block').hide();
          username = $('#username').val();
          socket = io();
          socket.emit('join', { email: username });

          //event listeners
          socket.on('join', function (msg) {
            //$('#clients').append($('<li>').text(msg.username + ' joined'));
            var users = '';
            msg.users.forEach(function (item) {
              users += item + ' | ';
            });
            $('#users').html(users);
          });
          socket.on('leave', function (msg) {
            //$('#clients').append($('<li>').text(msg.username + ' left'));
            var users = '';
            msg.users.forEach(function (item) {
              users += item + ' | ';
            });
            $('#users').html(users);
          });
          socket.on('chat message', function(msg) {
            $('#messages').append($('<li>').text(msg.username + ': ' + msg.message));
          });
          socket.on('login', function(msg) {
            $('#self').html('loggedin as: ' + msg.username);
            var rooms = '';
            msg.rooms.forEach(function (item) {
              rooms += item + ' | ';
            });
            $('#rooms').html(rooms);
          });
          socket.on('createRoom', function (msg) {
            var rooms = '';
            msg.rooms.forEach(function (item) {
              rooms += item + ' | ';
            });
            $('#rooms').html(rooms);
          });   
        }
      });

      $('form').submit(function(event){
        event.preventDefault();
        socket.emit('chat message', $('#m').val(), $('#recipient_user').val(), $('#recipient_room').val());
        $('#m').val('');
        $('#recipient_user').val('');
        $('#recipient_room').val('');
        return false;
      });

      $('#createRoomBtn').click(function () {
        socket.emit('createRoom', { room: $('#room').val() });
        $('#room').val('');
      });

      $('#joinRoomBtn').click(function () {
        socket.emit('joinRoom', { room: $('#room').val() });
        $('#room').val('');
      });

    </script>

  </body>
</html>